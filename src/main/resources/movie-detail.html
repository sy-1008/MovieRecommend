<!doctype html>
<html lang="en">

<head>

    <!-- Basic Page Needs
    ================================================== -->
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <link rel="icon" href="assets/images/favicon.png">

    <!-- CSS
    ================================================== -->
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/night-mode.css">
    <link rel="stylesheet" href="assets/css/framework.css">
    <link rel="stylesheet" href="assets/layui/css/layui.css" media="all">

    <!-- icons
    ================================================== -->
    <link rel="stylesheet" href="assets/css/icons.css">

    <!-- Google font
    ================================================== -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">


</head>

<body>

<!-- Wrapper -->
<div id="wrapper">

    <!-- sidebar -->
    <div class="main_sidebar">
        <div class="side-overlay" uk-toggle="target: #wrapper ; cls: collapse-sidebar mobile-visible"></div>

        <!-- sidebar header -->
        <div class="sidebar-header">
            <h4> Navigation</h4>
            <span class="btn-close" uk-toggle="target: #wrapper ; cls: collapse-sidebar mobile-visible"></span>
        </div>

        <!-- sidebar Menu -->
        <div class="sidebar">
            <div class="sidebar_innr" data-simplebar>

                <div class="sections">
                    <!--                       <h3> Browse </h3>-->
                    <ul>
                        <li class="active"><a href="index.html"> <i class="uil-home-alt"></i> 首页 </a></li>
                        <li><a href="fenlei.html"> <i class="uil-layers"></i> 分类 </a></li>
                        <li><a href="single.html"> <i class="uil-users-alt"></i> 个人中心 </a></li>
                    </ul>
                </div>


                <div class="sections">
                    <!--                        <h3> Subscriptions </h3>-->
                    <ul>
                        <li><a href="browse-channals.html"> <i class="icon-material-outline-favorite-border"></i> 推荐
                        </a></li>
                        <li><a href="browse-channals.html"> <i class="icon-material-baseline-star-border"></i> 热播 </a>
                        </li>

                    </ul>


                </div>


                <div id="foot" style="margin-top: 200px">
                    <div class="foot-content">
                        <p>© 2020 <strong>Movies Pro</strong>. All Rights Reserved. </p>
                    </div>
                </div>


            </div>


        </div>

    </div>

    <!-- header -->
    <div id="main_header">
        <header>

            <!-- Logo-->
            <i class="header-traiger uil-bars"
               uk-toggle="target: #wrapper ; cls: collapse-sidebar mobile-visible"></i>

            <!-- Logo-->
            <div id="logo">
                <a href="#"> <img src="assets/images/logo.png" alt=""></a>
                <a href="#"> <img src="assets/images/logo-light.png" class="logo-inverse" alt=""></a>
            </div>

            <!-- form search-->
            <div class="head_search">
                <form>
                    <div class="head_search_cont">
                        <input value="" type="text" class="form-control"
                               placeholder="Search for Videos, Games, Movies and more.." autocomplete="off">
                        <i class="s_icon uil-search-alt"></i>
                    </div>

                    <!-- Search box dropdown -->
                    <div uk-dropdown="pos: top;mode:click;animation: uk-animation-slide-bottom-small"
                         class="dropdown-search">
                        <!-- User menu -->

                        <ul class="dropdown-search-list">
                            <li class="list-title"> Recent Searches</li>
                            <li><a href="single-movies.html"> Adobe XD Design Free Tutorial .. </a></li>
                            <li><a href="single-movies.html"> How to create a basic Sticky HTML element .. </a>
                            </li>
                            <li><a href="single-movies.html"> Learn How to Prototype Faster with Mockplus! in 2020
                            </a></li>
                            <li><a href="single-movies.html"> Adobe XD Design Tutorial Company Website Landing Page
                                .. </a></li>

                        </ul>

                    </div>


                </form>
            </div>

            <!-- user icons -->
            <div class="head_user">


                <!-- profile -image -->
                <a class="opts_account"> <img id="LoginUser2" src=""></a>

                <!-- profile dropdown-->
                <div uk-dropdown="pos: top-right;mode:click ; animation: uk-animation-slide-bottom-small"
                     class="dropdown-notifications small">

                    <!-- User Name / Avatar -->
                    <a href="#">

                        <div class="dropdown-user-details">
                            <div class="dropdown-user-avatar">
                                <img id="LoginUser1" src="" alt="">
                            </div>
                            <div class="dropdown-user-name">
                                Richard Ali <span> verified <i class="uil-check"></i> </span>
                            </div>
                        </div>

                    </a>

                    <!-- User menu -->

                    <ul class="dropdown-user-menu">
                        <li><a href="#"> <i class="uil-bolt"></i> Go PRO</a></li>
                        <li><a href="#"> <i class="uil-user"></i> My Channal </a></li>
                        <li><a href="#"> <i class="uil-thumbs-up"></i> Liked Movies </a></li>
                        <li><a href="#"> <i class="uil-history"></i> Watch Later </a></li>
                        <li><a href="#"> <i class="uil-cog"></i> Account Settings</a></li>
                        <li><a href="#" style="color:#ff8400"> <i class="uil-bolt"></i> Upgrade To Premium</a></li>
                        <li>
                            <a href="#" id="night-mode" class="btn-night-mode">
                                <i class="icon-feather-moon"></i> Night mode
                                <span class="btn-night-mode-switch">
                                        <span class="uk-switch-button"></span>
                                    </span>
                            </a>
                        </li>
                        <div class="menu-divider">
                            <li><a href="#"> <i class="icon-feather-help-circle"></i> Help</a>
                            </li>
                            <li><a href="#"> <i class="icon-feather-log-out"></i> Log out</a>
                            </li>
                        </div>
                    </ul>


                </div>

            </div>

        </header>

    </div>


    <!-- contents -->
    <div class="main_content">
        <div class="main_content_inner">

            <div uk-grid>
                <div class="uk-width-2-3@m">

                    <div id="video-box" uk-sticky="top: 400 ;media : @s"
                         cls-active="video-resized uk-animation-slide-right;">
                            <span class="icon-feather-x btn-box-close"
                                  uk-toggle="target: #video-box ; cls: video-resized-hedden uk-animation-slide-left"></span>

                        <div class="embed-video">
                            <iframe id="video" src="" frameborder="0"
                                    uk-video="automute: true" allowfullscreen uk-responsive></iframe>
                        </div>
                    </div>

                    <div class="video-info mt-3">

                        <!-- video title -->
                        <div class="video-info-title">
                            <h1 id="cname" type="text"></h1>
                        </div>

                        <div class="uk-flex uk-flex-between">

                            <div class="video-info-details">
                                <span id="nviews"> views </span>
                            </div>

                            <div>
                                <div id="test1"></div>
                                <button type="button" class="layui-btn" id="getRate">提交</button>
                            </div>
<!--                            <div class="video-likes">-->
<!--                                <div class="like-btn" uk-tooltip="I like it">-->
<!--                                    <i class="uil-thumbs-up"></i>-->
<!--                                    <span class="likes">21</span>-->
<!--                                </div>-->
<!--                                <div class="video-info-element">-->
<!--                                    <div class="views-bar"></div>-->
<!--                                    <div class="views-bar blue" style="width: 40%"></div>-->
<!--                                </div>-->
<!--                                <div class="like-btn" uk-tooltip="I Hate it">-->
<!--                                    <i class="uil-thumbs-down"></i>-->
<!--                                    <span class="likes">14</span>-->
<!--                                </div>-->
<!--                            </div>-->

                        </div>
                        <div class="uk-flex uk-flex-between">

                            <div class="video-info-details">

                                <span id="date"></span>
                            </div>
                            <div>

                                <span id="language"></span>
                            </div>
                        </div>


                        <!--                        <div class="uk-flex uk-flex-between uk-flex-middle" uk-grid>-->
                        <!--                            <div class="user-details-card uk-width-expand">-->
                        <!--                                <a href="single-channal.html" class="uk-flex">-->
                        <!--                                    <div class="user-details-card-avatar">-->
                        <!--                                        <img src="assets/images/avatars/avatar-2.jpg" alt="">-->
                        <!--                                    </div>-->
                        <!--                                    <div class="user-details-card-name">-->
                        <!--                                        Stella Johnson <span> Published on Oct 22, 2017 </span>-->
                        <!--                                    </div>-->
                        <!--                                </a>-->
                        <!--                            </div>-->
                        <!--                            <div class="uk-width-auto uk-flex">-->


                        <!--                                <div class="btn-subscribe">-->
                        <!--                                    <a href="#" class="button danger"> <i class="icon-feather-plus"></i>-->
                        <!--                                        subscribe </a>-->
                        <!--                                    <span class="subs-amount">1200</span>-->
                        <!--                                </div>-->

                        <!--                            </div>-->
                        <!--                        </div>-->

                        <hr class="mt-0 mb-2">


                        <h2> 简介</h2>
                        <p id="cInfo"></p>


                        <div class="about-ch-sec mb-lg-6">

                            <div class="abt-rw">
                                <h2>信息</h2>
                                <p> Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor
                                    incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis
                                    nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
                                    Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
                                    fugiat nulla pariatur </p>
                            </div>
                            <div>
                                <h2>类型</h2>
                                <ul>
                                    <li id="cType"></li>

                                </ul>
                            </div>
                        </div>


                    </div>

                    <hr>

                    <div class="comments mt-4">
                        <h3> 评论 <span class="comments-amount"></span></h3>

                        <ul id="commentList">
                            <!--                            <li>-->
                            <!--                                <div class="avatar"><img id="powerCImage" src="" alt="">-->
                            <!--                                </div>-->
                            <!--                                <div class="comment-content">-->
                            <!--                                    <div class="comment-by">-->
                            <!--                                        <h3 id="powerCName">用户名</h3>-->
                            <!--                                        <span id="powerNRole">高级用户</span>-->
                            <!--                                        <a href="#" class="reply"><i class="icon-line-awesome-undo"></i>-->
                            <!--                                            Reply</a>-->
                            <!--                                    </div>-->
                            <!--                                    <p id="ccontent"> </p>-->
                            <!--                                    <p id="dcreateTime"> </p>-->
                            <!--                                </div>-->

                            <!--                            </li>-->


                        </ul>

                    </div>

                    <div class="comments">
                        <h4>你的评论 </h4>
                        <ul>
                            <li>
                                <div class="avatar"><img id="LoginUser" src="">
                                </div>
                                <div class="comment-content">
                                    <div class="uk-grid-small" uk-grid>
                                        <div class="uk-width-1-1@s">
                                            <label class="uk-form-label">Comment</label>
                                            <textarea id="ccontent" class="uk-textarea"
                                                      placeholder="Enter Your Comments her..."
                                                      style=" height:160px"></textarea>
                                        </div>
                                        <div class="uk-grid-margin">
                                            <input id="sbm" value="submit" class="button warning">
                                        </div>
                                    </div>

                                </div>
                            </li>
                        </ul>
                    </div>


                </div>
                <div class="uk-width-expand@m">
                    <button class="button  soft-warning button Large" style="align-items: center"
                            onclick="javascript:window.location.href='commontest.html'">参与答题
                    </button>
                    <div class="uk-flex uk-flex-middle uk-flex-between px-1 pb-3">
                        <p class="mb-0 uk-h5"> 相似推荐 </p>


                    </div>
                    <div class="video-list-small uk-child-width-1-1@m uk-child-width-1-2@s" uk-grid>


                        <div>
                            <a href="#" class="video-post video-post-list">
                                <!-- Blog Post Thumbnail -->
                                <div class="video-post-thumbnail">
                                    <span class="video-post-count">1.4M</span>
                                    <span class="video-post-time">23:00</span>
                                    <span class="play-btn-trigger"></span>

                                    <img src="assets/images/video-thumbal/2.png" alt="">

                                </div>

                                <!-- Blog Post Content -->
                                <!--                                <div class="video-post-content">-->
                                <!--                                    <h3> 电影名 </h3>-->
                                <!--                                    <img src="assets/images/avatars/avatar-3.jpg" alt="">-->
                                <!--                                    <span class="video-post-user">Jonathan Madano</span>-->
                                <!--                                    <span class="video-post-views">531k views</span>-->
                                <!--                                    <span class="video-post-date"> 2 weeks ago </span>-->
                                <!--                                    &lt;!&ndash; option menu &ndash;&gt;-->
                                <!--                                    <span class="btn-option">-->
                                <!--                                            <i class="icon-feather-more-vertical"></i>-->
                                <!--                                        </span>-->
                                <!--                                    <div class="dropdown-option-nav"-->
                                <!--                                         uk-dropdown="pos: bottom-right ;mode : hover ;animation: uk-animation-slide-bottom-small">-->
                                <!--                                        <ul>-->
                                <!--                                            <li> <span> <i class="uil-history"></i> Watch Later</span> </li>-->
                                <!--                                            <li> <span> <i class="uil-bookmark"></i> Add Bookmark</span> </li>-->
                                <!--                                            <li> <span> <i class="uil-share-alt"></i> Share Your Friends</span>-->
                                <!--                                            </li>-->
                                <!--                                        </ul>-->
                                <!--                                    </div>-->
                                <!--                                </div>-->
                            </a>
                        </div>


                    </div>


                </div>


            </div>

            <!-- footer
           ================================================== -->
            <div class="footer">


            </div>

        </div>

    </div>

</div>


<!-- For Night mode -->
<script>
    (function (window, document, undefined) {
        'use strict';
        if (!('localStorage' in window)) return;
        var nightMode = localStorage.getItem('gmtNightMode');
        if (nightMode) {
            document.documentElement.className += ' night-mode';
        }
    })(window, document);


    (function (window, document, undefined) {

        'use strict';

        // Feature test
        if (!('localStorage' in window)) return;

        // Get our newly insert toggle
        var nightMode = document.querySelector('#night-mode');
        if (!nightMode) return;

        // When clicked, toggle night mode on or off
        nightMode.addEventListener('click', function (event) {
            event.preventDefault();
            document.documentElement.classList.toggle('night-mode');
            if (document.documentElement.classList.contains('night-mode')) {
                localStorage.setItem('gmtNightMode', true);
                return;
            }
            localStorage.removeItem('gmtNightMode');
        }, false);

    })(window, document);
</script>


<!-- javaScripts
            ================================================== -->
<script src="assets/js/framework.js"></script>
<script src="assets/js/jquery-3.3.1.min.js"></script>
<script src="assets/js/simplebar.js"></script>
<script src="assets/js/main.js"></script>

<style>
    .copyrights {
        text-indent: -9999px;
        height: 0;
        line-height: 0;
        font-size: 0;
        overflow: hidden;
    }
</style>
<script>

    function timeFormat(time) {
        // 时间格式化 2019-09-08
        var year = time.getFullYear();
        var month = time.getMonth() + 1 > 10 ? time.getMonth()+1 : '0'+(time.getMonth()+1);
        var day = time.getDate() > 10 ? time.getDate() : "0" + time.getDate();
        return year + "-" + month + "-" + day;
    }

</script>
<script>
    $(document).ready(function () {
        var movieId = localStorage.getItem("movieId");
        var userId = localStorage.getItem("userId");
        console.log(movieId);
        $.ajax({
            url: 'http://localhost:8080/getMovieDetail?id=' + movieId,//后台请求的数据
            dataType: 'json', //数据格式
            type: "get",//请求方式
            async: true,//是否异步请求
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                var dd = data.data;
                $("#cname").html(dd.cname);
                $("#cInfo").html(dd.cinfo);
                $("#nviews").html(dd.nviews + ' Views');
                $("#cType").html(dd.cmovieType);
                $("#date").html(dd.dreleaseDate);
                $("#language").html(dd.cmovieLanguage);
                $('#video').attr('src', dd.cvideo);

            },
            error: function (arg1) {
                alert("加载数据失败");
                console.log(arg1);
            }
        })


        $.ajax({
            url: 'http://localhost:8080/showCommentsList?movieId=' + movieId,//后台请求的数据
            dataType: 'json', //数据格式
            type: "get",//请求方式
            async: true,//是否异步请求
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                var tt = data.data;
                var str1 = "";
                for (var i = 0; i < tt.length; i++) {
                    var powerCImage = tt[i].powerCImage;
                    str1 += "<li>" +
                        "<div class=\"avatar\"><img  src='" + powerCImage + "'>" +
                        "</div>" +
                        "<div class=\"comment-content\">" +
                        "<div class=\"comment-by\">" +
                        "<h3>" + tt[i].powerCName + "</h3>" +
                        "<a class=\"reply\"><i class=\"icon-line-awesome-undo\"></i>Reply</a>" +
                        "</div>" +
                        "<p >" + tt[i].ccontent + " </p>" +
                        "<p >" + tt[i].dcreateTime + " </p>" +
                        "</div>" +
                        "</li>"
                }
                commentList.innerHTML = str1;
            },
            error: function (arg1) {
                alert("加载数据失败");
                console.log(arg1);
            }
        })


        $("#sbm").click(function () {
            var curDate =timeFormat(new Date())

            console.log(curDate);
            var content = {
                npowerId: userId,
                nmovieId: movieId,
                ccontent: $('#ccontent').val(),
                dcreateTime: curDate
            }
            $.ajax({
                url: 'http://localhost:8080/addComment',
                type: 'post',
                dataType: "json",
                data: JSON.stringify(content),
                async: true,//是否异步请求
                xhrFields: {withCredentials: true},
                crossDomain: true,
                contentType: 'application/json; charset=UTF-8',
                success: function (data) {
                    // data = JSON.parse(data);

                    var code = data.status;
                    if (code === 0) {
                        window.location.href = 'movie-detail.html';
                        layer.alert("评论新增成功");
                    } else {
                        layer.alert(data.msg);
                    }
                }
            });
            return false;
        })
    })
</script>
<script>
    $(document).ready(function () {

        $.ajax({
            url: "http://localhost:8080/showUserDetail",//后台请求的数据
            dataType: 'json', //数据格式
            type: "get",//请求方式
            async: true,//是否异步请求
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {

                var dd = data.data;

                $('#LoginUser').attr('src', dd.cuserImage);
                $('#LoginUser1').attr('src', dd.cuserImage);
                $('#LoginUser2').attr('src', dd.cuserImage);
            }
        })
    })
</script>
<script src="assets/layui/layui.js"></script>
<script>
    layui.use(['rate','jquery'], function(){
        var $ = layui.jquery;
        var rate = layui.rate;

        //渲染
        var instance= rate.render({
            elem: '#test1' , //绑定元素
            half: true,
            choose: function (value) {
                // 此处点击分数之后可用Ajax传递到后台并保存到数据库 具体略
                // 评分完成之后重载实例
                rate.render({
                    elem: '#test1',
                    half: true,
                    // value值也可以是前台通过Ajax获取到的数据库中的值
                    value: value,
                    // 设置为只读防止多次评分
                    readonly: true
                })
            }
        });
        $("#getRate").click(function(){
            console.log(instance);
            // 打印出instance可知instance.config.value即是评分值
            layer.msg("电影评级："+instance.config.value);
        });
    });
</script>
</body>

</html>